<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± API Key - Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        body { font-family: 'Cairo', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-2xl shadow-lg p-8">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-indigo-600 mb-2">ğŸ”‘ Ø§Ø®ØªØ¨Ø§Ø± API Key</h1>
                <p class="text-gray-600">ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ù€ "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡"</p>
            </div>

            <!-- Test Section -->
            <div class="space-y-6">
                <!-- Test 1: Basic Connection -->
                <div class="border border-gray-200 rounded-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">1ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</h3>
                        <span id="test1-status" class="text-gray-400">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</span>
                    </div>
                    <p class="text-gray-600 mb-4">Ø³ÙŠØªÙ… Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡</p>
                    <button onclick="runTest1()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700">
                        Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    </button>
                    <div id="test1-result" class="mt-4 p-4 bg-gray-50 rounded-lg hidden"></div>
                </div>

                <!-- Test 2: AI Response -->
                <div class="border border-gray-200 rounded-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">2ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
                        <span id="test2-status" class="text-gray-400">â³ Ø§Ù†ØªØ¸Ø± Ø§Ø®ØªØ¨Ø§Ø± 1</span>
                    </div>
                    <p class="text-gray-600 mb-4">Ø³Ù†Ø³Ø£Ù„ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø¤Ø§Ù„ Ù…Ø¹Ù‚Ø¯ Ø¹Ù† Excel</p>
                    <button onclick="runTest2()" id="test2-btn" disabled class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed">
                        Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    </button>
                    <div id="test2-result" class="mt-4 p-4 bg-gray-50 rounded-lg hidden"></div>
                </div>

                <!-- Test 3: Response Quality -->
                <div class="border border-gray-200 rounded-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">3ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</h3>
                        <span id="test3-status" class="text-gray-400">â³ Ø§Ù†ØªØ¸Ø± Ø§Ø®ØªØ¨Ø§Ø± 2</span>
                    </div>
                    <p class="text-gray-600 mb-4">ØªØ­Ù„ÙŠÙ„ Ø¬ÙˆØ¯Ø© ÙˆØ°ÙƒØ§Ø¡ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</p>
                    <button onclick="runTest3()" id="test3-btn" disabled class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed">
                        Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„
                    </button>
                    <div id="test3-result" class="mt-4 p-4 bg-gray-50 rounded-lg hidden"></div>
                </div>
            </div>

            <!-- Final Results -->
            <div id="final-results" class="mt-8 p-6 bg-gradient-to-r from-indigo-50 to-blue-50 rounded-xl hidden">
                <h3 class="text-2xl font-bold text-center mb-4">ğŸ“Š Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
                <div id="final-content"></div>
            </div>

            <!-- Instructions -->
            <div class="mt-8 p-6 bg-yellow-50 border border-yellow-200 rounded-xl">
                <h4 class="font-bold text-yellow-800 mb-2">ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</h4>
                <ul class="list-disc list-inside text-yellow-700 space-y-1 text-sm">
                    <li>Ø¥Ø°Ø§ ÙØ´Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª: ØªØ­Ù‚Ù‚ Ù…Ù† API Key</li>
                    <li>Ø¥Ø°Ø§ Ù†Ø¬Ø­ Ø§Ø®ØªØ¨Ø§Ø± 1 ÙÙ‚Ø·: API Key ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ (ÙŠØ¹Ù…Ù„ Ø¨Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©)</li>
                    <li>Ø¥Ø°Ø§ Ù†Ø¬Ø­Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª: Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠØ¹Ù…Ù„ Ø¨ÙƒØ§Ù…Ù„ Ù‚Ø¯Ø±Ø§ØªÙ‡! ğŸ‰</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let sessionId = null;

        async function runTest1() {
            const statusEl = document.getElementById('test1-status');
            const resultEl = document.getElementById('test1-result');
            
            statusEl.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...';
            statusEl.className = 'text-blue-500';
            resultEl.classList.add('hidden');

            try {
                const response = await fetch('/platform/api/ai_chatbot.php?action=start', {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    sessionId = data.data.session_id;
                    statusEl.textContent = 'âœ… Ù†Ø¬Ø­';
                    statusEl.className = 'text-green-500 font-bold';
                    
                    resultEl.innerHTML = `
                        <div class="text-sm">
                            <p class="font-bold text-green-700 mb-2">âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­!</p>
                            <p class="text-gray-700"><strong>Session ID:</strong> ${sessionId}</p>
                            <p class="text-gray-700 mt-2"><strong>Ø±Ø³Ø§Ù„Ø© Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡:</strong></p>
                            <p class="text-gray-600 mt-1 text-xs">${data.data.message.substring(0, 150)}...</p>
                        </div>
                    `;
                    resultEl.classList.remove('hidden');
                    
                    // Enable test 2
                    document.getElementById('test2-btn').disabled = false;
                    document.getElementById('test2-btn').className = 'bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 cursor-pointer';
                    document.getElementById('test2-status').textContent = 'â¸ï¸ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡';
                } else {
                    throw new Error(data.error || 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„');
                }
            } catch (error) {
                statusEl.textContent = 'âŒ ÙØ´Ù„';
                statusEl.className = 'text-red-500 font-bold';
                
                resultEl.innerHTML = `
                    <div class="text-sm text-red-700">
                        <p class="font-bold mb-2">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</p>
                        <p>${error.message}</p>
                        <p class="mt-2">ØªØ­Ù‚Ù‚ Ù…Ù†:</p>
                        <ul class="list-disc list-inside mt-1">
                            <li>Ø£Ù† Ù…Ù„Ù ai_chatbot.php Ù…ÙˆØ¬ÙˆØ¯</li>
                            <li>Ø£Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¹Ù…Ù„</li>
                            <li>Ø£Ù† XAMPP ÙŠØ¹Ù…Ù„</li>
                        </ul>
                    </div>
                `;
                resultEl.classList.remove('hidden');
            }
        }

        async function runTest2() {
            const statusEl = document.getElementById('test2-status');
            const resultEl = document.getElementById('test2-result');
            
            statusEl.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...';
            statusEl.className = 'text-blue-500';
            resultEl.classList.add('hidden');

            try {
                const response = await fetch('/platform/api/ai_chatbot.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'chat',
                        message: 'Ø´Ø±Ø­ Ù„ÙŠ Ø¨Ø§Ù„ØªÙØµÙŠÙ„ ÙƒÙŠÙ ØªØ¹Ù…Ù„ Ø¯Ø§Ù„Ø© VLOOKUP ÙÙŠ Excel Ù…Ø¹ Ø£Ù…Ø«Ù„Ø© Ù…Ø¹Ù‚Ø¯Ø© ÙˆÙ…ØªÙ‚Ø¯Ù…Ø©',
                        session_id: sessionId
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const message = data.data.message;
                    const hasAPIKey = !message.includes('âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù„Ù…Ø·ÙˆØ±');
                    
                    statusEl.textContent = hasAPIKey ? 'âœ… Ù†Ø¬Ø­ (Ù…Ø¹ AI)' : 'âš ï¸ Ù†Ø¬Ø­ (Ø¨Ø¯ÙˆÙ† AI)';
                    statusEl.className = hasAPIKey ? 'text-green-500 font-bold' : 'text-yellow-500 font-bold';
                    
                    resultEl.innerHTML = `
                        <div class="text-sm">
                            <p class="font-bold ${hasAPIKey ? 'text-green-700' : 'text-yellow-700'} mb-2">
                                ${hasAPIKey ? 'âœ… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠØ¹Ù…Ù„!' : 'âš ï¸ ÙŠØ¹Ù…Ù„ Ø¨Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©'}
                            </p>
                            <p class="text-gray-700 mb-2"><strong>Ø·ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:</strong> ${message.length} Ø­Ø±Ù</p>
                            <p class="text-gray-700 mb-2"><strong>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:</strong></p>
                            <div class="text-gray-600 text-xs max-h-40 overflow-y-auto bg-white p-2 rounded border">
                                ${message.replace(/\n/g, '<br>')}
                            </div>
                            ${!hasAPIKey ? `
                                <div class="mt-3 p-3 bg-yellow-100 rounded border border-yellow-300">
                                    <p class="text-yellow-800 text-xs">
                                        <strong>ğŸ’¡ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø£ÙØ¶Ù„:</strong><br>
                                        Ø£Ø¶Ù OpenAI API Key ÙÙŠ Ù…Ù„Ù ai_chatbot.php<br>
                                        Ø±Ø§Ø¬Ø¹ Ù…Ù„Ù: API_KEY_SETUP_GUIDE.md
                                    </p>
                                </div>
                            ` : ''}
                        </div>
                    `;
                    resultEl.classList.remove('hidden');
                    
                    // Enable test 3
                    document.getElementById('test3-btn').disabled = false;
                    document.getElementById('test3-btn').className = 'bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 cursor-pointer';
                    document.getElementById('test3-status').textContent = 'â¸ï¸ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡';
                    
                    // Store for test 3
                    window.test2Response = {message, hasAPIKey};
                } else {
                    throw new Error(data.error || 'ÙØ´Ù„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø©');
                }
            } catch (error) {
                statusEl.textContent = 'âŒ ÙØ´Ù„';
                statusEl.className = 'text-red-500 font-bold';
                
                resultEl.innerHTML = `
                    <div class="text-sm text-red-700">
                        <p class="font-bold">âŒ Ø®Ø·Ø£</p>
                        <p>${error.message}</p>
                    </div>
                `;
                resultEl.classList.remove('hidden');
            }
        }

        async function runTest3() {
            const statusEl = document.getElementById('test3-status');
            const resultEl = document.getElementById('test3-result');
            
            const {message, hasAPIKey} = window.test2Response;
            
            // ØªØ­Ù„ÙŠÙ„ Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
            const quality = {
                length: message.length,
                hasExamples: message.includes('Ù…Ø«Ø§Ù„') || message.includes('Example'),
                hasEmojis: /[\u{1F300}-\u{1F9FF}]/u.test(message),
                hasFormatting: message.includes('ğŸ“Š') || message.includes('ğŸ’¡'),
                isDetailed: message.length > 300,
                hasCode: message.includes('=') && message.includes('VLOOKUP'),
            };
            
            const score = Object.values(quality).filter(Boolean).length - 1; // -1 for length
            const totalTests = Object.keys(quality).length - 1;
            const percentage = Math.round((score / totalTests) * 100);
            
            statusEl.textContent = 'âœ… Ø§ÙƒØªÙ…Ù„';
            statusEl.className = 'text-green-500 font-bold';
            
            resultEl.innerHTML = `
                <div class="text-sm">
                    <p class="font-bold text-green-700 mb-3">ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¬ÙˆØ¯Ø©:</p>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>Ø·ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</span>
                            <span class="${quality.length > 200 ? 'text-green-600' : 'text-yellow-600'}">${quality.length} Ø­Ø±Ù</span>
                        </div>
                        <div class="flex justify-between">
                            <span>ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ù…Ø«Ù„Ø©</span>
                            <span class="${quality.hasExamples ? 'text-green-600' : 'text-red-600'}">${quality.hasExamples ? 'âœ…' : 'âŒ'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¥ÙŠÙ…ÙˆØ¬ÙŠ</span>
                            <span class="${quality.hasEmojis ? 'text-green-600' : 'text-red-600'}">${quality.hasEmojis ? 'âœ…' : 'âŒ'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>ØªÙ†Ø³ÙŠÙ‚ Ø§Ø­ØªØ±Ø§ÙÙŠ</span>
                            <span class="${quality.hasFormatting ? 'text-green-600' : 'text-red-600'}">${quality.hasFormatting ? 'âœ…' : 'âŒ'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Ø¥Ø¬Ø§Ø¨Ø© ØªÙØµÙŠÙ„ÙŠØ©</span>
                            <span class="${quality.isDetailed ? 'text-green-600' : 'text-red-600'}">${quality.isDetailed ? 'âœ…' : 'âŒ'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙˆØ¯</span>
                            <span class="${quality.hasCode ? 'text-green-600' : 'text-red-600'}">${quality.hasCode ? 'âœ…' : 'âŒ'}</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t">
                        <div class="flex justify-between items-center">
                            <span class="font-bold">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©:</span>
                            <span class="text-2xl font-bold ${percentage >= 70 ? 'text-green-600' : 'text-yellow-600'}">${percentage}%</span>
                        </div>
                    </div>
                </div>
            `;
            resultEl.classList.remove('hidden');
            
            // Show final results
            showFinalResults(hasAPIKey, percentage);
        }

        function showFinalResults(hasAPIKey, qualityScore) {
            const finalEl = document.getElementById('final-results');
            const contentEl = document.getElementById('final-content');
            
            let status, color, recommendation;
            
            if (hasAPIKey && qualityScore >= 70) {
                status = 'ğŸ‰ Ù…Ù…ØªØ§Ø²! Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠØ¹Ù…Ù„ Ø¨ÙƒØ§Ù…Ù„ Ù‚Ø¯Ø±Ø§ØªÙ‡';
                color = 'text-green-600';
                recommendation = 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ø¨Ø«Ù‚Ø©.';
            } else if (hasAPIKey && qualityScore < 70) {
                status = 'âš ï¸ ÙŠØ¹Ù…Ù„ Ù„ÙƒÙ† ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†';
                color = 'text-yellow-600';
                recommendation = 'Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± AI_MODEL Ø¥Ù„Ù‰ gpt-4 Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø£ÙØ¶Ù„.';
            } else if (!hasAPIKey && qualityScore >= 50) {
                status = 'âœ… ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† AI (Ø¬ÙŠØ¯ Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©)';
                color = 'text-blue-600';
                recommendation = 'Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø¯Ø±Ø§Øª ÙƒØ§Ù…Ù„Ø©ØŒ Ø£Ø¶Ù OpenAI API Key. Ø±Ø§Ø¬Ø¹ API_KEY_SETUP_GUIDE.md';
            } else {
                status = 'âŒ ÙŠØ­ØªØ§Ø¬ Ø¥Ø¹Ø¯Ø§Ø¯';
                color = 'text-red-600';
                recommendation = 'ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ API Key Ø£Ùˆ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©.';
            }
            
            contentEl.innerHTML = `
                <div class="text-center">
                    <p class="text-2xl font-bold ${color} mb-4">${status}</p>
                    <p class="text-gray-700 mb-4">${recommendation}</p>
                    <div class="grid grid-cols-3 gap-4 mt-6">
                        <div class="p-4 bg-white rounded-lg shadow">
                            <p class="text-sm text-gray-600">Ø§Ù„Ø§ØªØµØ§Ù„</p>
                            <p class="text-2xl font-bold text-green-600">âœ…</p>
                        </div>
                        <div class="p-4 bg-white rounded-lg shadow">
                            <p class="text-sm text-gray-600">AI</p>
                            <p class="text-2xl font-bold ${hasAPIKey ? 'text-green-600' : 'text-yellow-600'}">${hasAPIKey ? 'âœ…' : 'âš ï¸'}</p>
                        </div>
                        <div class="p-4 bg-white rounded-lg shadow">
                            <p class="text-sm text-gray-600">Ø§Ù„Ø¬ÙˆØ¯Ø©</p>
                            <p class="text-2xl font-bold ${qualityScore >= 70 ? 'text-green-600' : 'text-yellow-600'}">${qualityScore}%</p>
                        </div>
                    </div>
                    <div class="mt-6">
                        <a href="/platform/index.html" class="inline-block bg-indigo-600 text-white px-8 py-3 rounded-lg hover:bg-indigo-700 font-bold">
                            Ø¬Ø±Ø¨ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¢Ù†! ğŸš€
                        </a>
                    </div>
                </div>
            `;
            
            finalEl.classList.remove('hidden');
        }
    </script>
</body>
</html>
