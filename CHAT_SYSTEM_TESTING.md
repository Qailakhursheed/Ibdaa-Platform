# ๐งช ุฏููู ุงุฎุชุจุงุฑ ูุธุงู ุงูุฏุฑุฏุดุฉ ุงููุชูุงูู

---

## โ ุงุฎุชุจุงุฑ 1: ุงูุชุญูู ูู ุฏูุฉ ุงููุตูู

### ุงููุฏู:
ุงูุชุฃูุฏ ูู ุฃู ุงูุฑุณุงูุฉ ุชุตู **ููุท** ูููุณุชูุจู ุงููุญุฏุฏ

### ุงูุฎุทูุงุช:

#### ุงูุฎุทูุฉ 1: ุชุญุถูุฑ ุงูุจูุงูุงุช
```sql
-- ุงูุชุญ phpMyAdmin ูุดุบู:
USE ibdaa_taiz;

-- ุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏููู
SELECT id, username, full_name, role FROM users LIMIT 10;
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
id | username  | full_name      | role
---|-----------|----------------|----------
4  | trainer1  | ุนุจุฏุงููู ุญุณู    | trainer
6  | student1  | ูุญูุฏ ุนุจุฏุงููู  | student
```

#### ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุงูุฑุณุงุฆู ุงูุญุงููุฉ
```sql
-- ุงุนุฑุถ ุฌููุน ุงูุฑุณุงุฆู ุจูู ุงููุฏุฑุจ ูุงูุทุงูุจ
SELECT 
    m.id,
    m.sender_id,
    m.receiver_id,
    s.username AS sender_username,
    r.username AS receiver_username,
    m.message_text,
    m.status,
    m.created_at
FROM messages m
INNER JOIN users s ON m.sender_id = s.id
INNER JOIN users r ON m.receiver_id = r.id
WHERE (m.sender_id = 4 AND m.receiver_id = 6)
   OR (m.sender_id = 6 AND m.receiver_id = 4)
ORDER BY m.created_at ASC;
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
id | sender_id | receiver_id | sender_username | receiver_username | message_text                    | status | created_at
---|-----------|-------------|-----------------|-------------------|---------------------------------|--------|-------------------
1  | 6         | 4           | student1        | trainer1          | ุฃุณุชุงุฐ ุนุจุฏุงูููุ ูุฏู ุงุณุชูุณุงุฑ...  | seen   | 2024-01-10 15:30
2  | 4         | 6           | trainer1        | student1          | ูุนูุ ููููู ุงุณุชุฎุฏุงู ุฃู...        | seen   | 2024-01-10 16:00
```

#### ุงูุฎุทูุฉ 3: ุชุญุฏูุฏ ุงููุฏู
- **ุงููุฑุณู:** trainer1 (ID: 4)
- **ุงููุณุชูุจู:** student1 (ID: 6)
- **ุงูุฑุณุงูุฉ:** "ุฑุณุงูุฉ ุงุฎุชุจุงุฑ ุฏูููุฉ"

#### ุงูุฎุทูุฉ 4: ุฅุฑุณุงู ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ (ุนุจุฑ API)

```bash
# ุงุณุชุฎุฏู curl ุฃู Postman:
curl -X POST http://localhost/Ibdaa-Taiz/Manager/api/send_message.php \
  -H "Content-Type: application/json" \
  -d '{
    "receiver_id": 6,
    "message_text": "ุฑุณุงูุฉ ุงุฎุชุจุงุฑ ุฏูููุฉ - ูู ูุตูุชู ุจุดูู ุตุญูุญุ"
  }' \
  -c cookies.txt  # ูุชุฎุฒูู ุงูุฌูุณุฉ
```

#### ุงูุฎุทูุฉ 5: ุงูุชุญูู ูู ูุตูู ุงูุฑุณุงูุฉ
```sql
-- ุชุญูู ูู ุงูุฑุณุงูุฉ ุงูุฌุฏูุฏุฉ
SELECT * FROM messages 
WHERE sender_id = 4 AND receiver_id = 6 
ORDER BY created_at DESC LIMIT 1;
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
โ sender_id = 4 (ุงููุฏุฑุจ ุจุงูุถุจุท)
โ receiver_id = 6 (ุงูุทุงูุจ ุงููุญุฏุฏ ููุท)
โ message_text = "ุฑุณุงูุฉ ุงุฎุชุจุงุฑ ุฏูููุฉ..."
โ status = sent
โ created_at = ุงูุขู
```

#### ุงูุฎุทูุฉ 6: ุงูุชุฃูุฏ ูู ุนุฏู ูุตูู ุงูุฑุณุงูุฉ ููุณุชุฎุฏู ุขุฎุฑ
```sql
-- ุชุญูู ุฃู ุงูุฑุณุงูุฉ ูู ุชุตู ููุทุงูุจ ุงูุขุฎุฑ (student2 - ID: 7)
SELECT COUNT(*) as count FROM messages 
WHERE receiver_id = 7 AND message_text LIKE 'ุฑุณุงูุฉ ุงุฎุชุจุงุฑ%';

-- ูุฌุจ ุฃู ุชููู ุงููุชูุฌุฉ = 0
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
โ count = 0 (ุงูุฑุณุงูุฉ ูู ุชุตู ูุฃุญุฏ ุขุฎุฑ)
```

---

## โ ุงุฎุชุจุงุฑ 2: ุงูุชุญูู ูู ุงูุฅุดุนุงุฑุงุช ุงูููุฑูุฉ

### ุงููุฏู:
ุงูุชุฃูุฏ ูู ุฃู ุงูุฅุดุนุงุฑ ูุตู ูููุณุชูุจู ุงูุตุญูุญ ููุฑุงู

#### ุงูุฎุทูุงุช:

##### ุงูุฎุทูุฉ 1: ุงุนุฑุถ ุงูุฅุดุนุงุฑุงุช ููุทุงูุจ ูุจู ุงูุฅุฑุณุงู
```sql
SELECT COUNT(*) as count FROM notifications 
WHERE user_id = 6 AND created_at > NOW() - INTERVAL 5 MINUTE;
```

**ุงูุชุจ ุงููุชูุฌุฉ:** `count_before = ___`

##### ุงูุฎุทูุฉ 2: ุฃุฑุณู ุฑุณุงูุฉ ุฌุฏูุฏุฉ
```
ุฅุฑุณุงู ุฑุณุงูุฉ ูู trainer1 ุฅูู student1
```

##### ุงูุฎุทูุฉ 3: ุงุนุฑุถ ุงูุฅุดุนุงุฑุงุช ุจุนุฏ ุงูุฅุฑุณุงู ูุจุงุดุฑุฉ
```sql
SELECT * FROM notifications 
WHERE user_id = 6 AND type = 'info'
ORDER BY created_at DESC LIMIT 1;
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
โ user_id = 6 (ุงูุทุงูุจ ุจุงูุถุจุท)
โ title = "ุฑุณุงูุฉ ุฌุฏูุฏุฉ"
โ message = "ุฑุณุงูุฉ ุฌุฏูุฏุฉ ูู ุนุจุฏุงููู ุญุณู"
โ is_read = 0 (ูู ุชูุฑุฃ)
โ created_at = ุงูุขู (ููุฑู)
```

##### ุงูุฎุทูุฉ 4: ุชุฃูุฏ ุฃู ุงูุฅุดุนุงุฑ ูู ูุตู ููุณุชุฎุฏู ุขุฎุฑ
```sql
SELECT COUNT(*) as count FROM notifications 
WHERE user_id = 7 
  AND message LIKE '%ุฑุณุงูุฉ ุงุฎุชุจุงุฑ ุฏูููุฉ%'
  AND created_at > NOW() - INTERVAL 5 MINUTE;

-- ูุฌุจ ุฃู ุชููู ุงููุชูุฌุฉ = 0
```

---

## โ ุงุฎุชุจุงุฑ 3: ุญุงูุฉ ุงูุฑุณุงูุฉ (seen vs sent)

### ุงููุฏู:
ุงูุชุฃูุฏ ูู ุชุญุฏูุซ ุญุงูุฉ ุงูุฑุณุงูุฉ ูู "sent" ุฅูู "seen"

#### ุงูุฎุทูุงุช:

##### ุงูุฎุทูุฉ 1: ุฃุฑุณู ุฑุณุงูุฉ ุฌุฏูุฏุฉ
```
ุงูุฑุณุงูุฉ: "ุงุฎุชุจุฑ ุญุงูุฉ ุงูุฑุณุงูุฉ"
ูู: trainer1 (4)
ุฅูู: student1 (6)
```

##### ุงูุฎุทูุฉ 2: ุชุญูู ูู ุงูุญุงูุฉ ุงูุฃูููุฉ
```sql
SELECT status FROM messages 
WHERE sender_id = 4 AND receiver_id = 6 
ORDER BY created_at DESC LIMIT 1;
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** `sent`

##### ุงูุฎุทูุฉ 3: ุงุฌูุจ ุงูุฑุณุงุฆู (ุณูุญุฏุซ ุชุบููุฑ ุงูุญุงูุฉ ุชููุงุฆูุงู)
```json
GET /Manager/api/get_messages.php?contact_id=4

Response:
{
  "messages": [
    {
      "status": "seen",  // โ ุชุบูุฑุช ูู sent
      "is_mine": false
    }
  ]
}
```

##### ุงูุฎุทูุฉ 4: ุชุญูู ูู ุงูุญุงูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```sql
SELECT status FROM messages 
WHERE sender_id = 4 AND receiver_id = 6 
ORDER BY created_at DESC LIMIT 1;
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** `seen` โ

---

## โ ุงุฎุชุจุงุฑ 4: ูุญุงุฏุซุฉ ูุงููุฉ ุซูุงุฆูุฉ ุงูุงุชุฌุงู

### ุงููุฏู:
ุงุฎุชุจุงุฑ ุชุจุงุฏู ุฑุณุงุฆู ูุงูู ุจูู ูุณุชุฎุฏููู

#### ุงูุฎุทูุงุช:

##### ุงูุฎุทูุฉ 1: ุงููุฏุฑุจ ูุฑุณู ูุฑุณุงูุฉ ููุทุงูุจ
```
ูู: trainer1 (4)
ุฅูู: student1 (6)
ุงููุต: "ุณุคุงูู ุตุญูุญ ุฌุฏุงูุ ุดูุฑุงู"
```

##### ุงูุฎุทูุฉ 2: ุงูุทุงูุจ ูุฑู ุงูุฑุณุงูุฉ
```
ุณุฌู ุฏุฎูู ูู student1
ุงุนุฑุถ ูุญุงุฏุซุชู ูุน trainer1
```

**ุงูุชุญูู:**
```
โ ุงูุฑุณุงูุฉ ุชุธูุฑ ุจู "is_mine": false
โ ุงุณู ุงููุฑุณู: "ุนุจุฏุงููู ุญุณู"
โ ุงููุต ูุงูู ูุฏููู
```

##### ุงูุฎุทูุฉ 3: ุงูุทุงูุจ ูุฑุฏ ุจุฑุณุงูุฉ
```
ูู: student1 (6)
ุฅูู: trainer1 (4)
ุงููุต: "ุดูุฑุงู ุฃุณุชุงุฐ ุนูู ุงูุดุฑุญ ุงูููุชุงุฒ"
```

##### ุงูุฎุทูุฉ 4: ุงููุฏุฑุจ ูุฑู ุงูุฑุฏ
```
ุณุฌู ุฏุฎูู ูู trainer1
ุงุนุฑุถ ูุญุงุฏุซุชู ูุน student1
```

**ุงูุชุญูู:**
```
โ ุงูุฑุณุงูุฉ ุงูุฃููู ูู ุงููุฏุฑุจ ุชุธูุฑ ุจู "is_mine": true
โ ุงูุฑุฏ ูู ุงูุทุงูุจ ูุธูุฑ ุจู "is_mine": false
โ ุงูุชุฑุชูุจ ุตุญูุญ (ุงูุฃูุฏู ุฃููุงู)
```

##### ุงูุฎุทูุฉ 5: ุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```sql
SELECT 
    sender_id,
    receiver_id,
    message_text,
    status,
    created_at
FROM messages
WHERE (sender_id = 4 AND receiver_id = 6)
   OR (sender_id = 6 AND receiver_id = 4)
ORDER BY created_at ASC;
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
| sender | receiver | message               | status |
|--------|----------|----------------------|--------|
| 4      | 6        | ุณุคุงูู ุตุญูุญ ุฌุฏุงู... | seen   |
| 6      | 4        | ุดูุฑุงู ุฃุณุชุงุฐ...     | sent   |
```

---

## โ ุงุฎุชุจุงุฑ 5: ููุน ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ

### ุงุฎุชุจุงุฑ 5A: ุฑุณุงูุฉ ูุงุฑุบุฉ
```
ูุญุงููุฉ: ุฅุฑุณุงู ุฑุณุงูุฉ ุจุฏูู ูุต
```

**ุงูุชููุน:**
```json
{
  "success": false,
  "message": "ูุต ุงูุฑุณุงูุฉ ูุงุฑุบ"
}
```

### ุงุฎุชุจุงุฑ 5B: ูุณุชูุจู ุบูุฑ ููุฌูุฏ
```
ูุญุงููุฉ: ุฅุฑุณุงู ุฑุณุงูุฉ ุฅูู user_id = 999 (ุบูุฑ ููุฌูุฏ)
```

**ุงูุชููุน:**
```json
{
  "success": false,
  "message": "ุงููุณุชุฎุฏู ุงููุณุชูู ุบูุฑ ููุฌูุฏ"
}
```

### ุงุฎุชุจุงุฑ 5C: ุฑุณุงูุฉ ูููุณู
```
ูุญุงููุฉ: ุฅุฑุณุงู ุฑุณุงูุฉ ูู trainer1 (4) ุฅูู ููุณู (4)
```

**ุงูุชููุน:**
```json
{
  "success": false,
  "message": "ูุง ููููู ุฅุฑุณุงู ุฑุณุงูุฉ ูููุณู"
}
```

### ุงุฎุชุจุงุฑ 5D: ุฑุณุงูุฉ ุทูููุฉ ุฌุฏุงู
```
ูุญุงููุฉ: ุฅุฑุณุงู ุฑุณุงูุฉ ุจู 6000 ุญุฑู (ุงูุญุฏ ุงูุฃูุตู 5000)
```

**ุงูุชููุน:**
```json
{
  "success": false,
  "message": "ุงูุฑุณุงูุฉ ุทูููุฉ ุฌุฏุงู (ุงูุญุฏ ุงูุฃูุตู 5000 ุญุฑู)"
}
```

---

## โ ุงุฎุชุจุงุฑ 6: ุงูุญูุงูุฉ ูุงูุฃูุงู

### ุงุฎุชุจุงุฑ 6A: ุจุฏูู ุชุณุฌูู ุฏุฎูู
```
ูุญุงููุฉ: ุฅุฑุณุงู ุฑุณุงูุฉ ุจุฏูู ุฌูุณุฉ ูุดุทุฉ
```

**ุงูุชููุน:**
```json
{
  "success": false,
  "message": "ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู"
}
```

### ุงุฎุชุจุงุฑ 6B: ูุนุฏู ุงูุฅุฑุณุงู ุงูุณุฑูุน
```
ูุญุงููุฉ: ุฅุฑุณุงู 121 ุฑุณุงูุฉ ูู 60 ุซุงููุฉ
```

**ุงูุชููุน:**
```
ุงูุฑุณุงูุฉ 121+: ุชู ุชุทุจูู Rate Limiting
HTTP Status: 429 Too Many Requests
```

---

## โ ุงุฎุชุจุงุฑ 7: ุนุฑุถ ุงููุญุงุฏุซุงุช ุงููุงููุฉ

### ุงููุฏู:
ุงูุชุฃูุฏ ูู ุฃู API ูุฌูุจ ุฌููุน ุงูุฑุณุงุฆู ุจูู ูุณุชุฎุฏููู

```
GET /Manager/api/get_messages.php?contact_id=4&limit=50&offset=0
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```json
{
  "success": true,
  "messages": [
    {
      "id": 1,
      "sender_id": 6,
      "receiver_id": 4,
      "sender_name": "ูุญูุฏ ุนุจุฏุงููู",
      "receiver_name": "ุนุจุฏุงููู ุญุณู",
      "message_text": "ุฃุณุชุงุฐ ุนุจุฏุงููู...",
      "is_mine": false,
      "status": "seen",
      "created_at": "2024-01-10 15:30:00"
    },
    {
      "id": 2,
      "sender_id": 4,
      "receiver_id": 6,
      "sender_name": "ุนุจุฏุงููู ุญุณู",
      "receiver_name": "ูุญูุฏ ุนุจุฏุงููู",
      "message_text": "ูุนูุ ููููู...",
      "is_mine": true,
      "status": "seen",
      "created_at": "2024-01-10 16:00:00"
    }
  ],
  "total": 2,
  "contact": {
    "id": 4,
    "name": "ุนุจุฏุงููู ุญุณู",
    "role": "trainer"
  },
  "marked_as_read": 0
}
```

โ **ุฌููุน ุงูุฑุณุงุฆู ูุฑุชุจุฉ ููุน ูุนูููุงุช ุตุญูุญุฉ**

---

## ๐ ูุงุฆูุฉ ุชุญูู ุงูุงุฎุชุจุงุฑุงุช

### ุงูุงุฎุชุจุงุฑุงุช ุงูุฃุณุงุณูุฉ:
- [ ] ุงุฎุชุจุงุฑ 1: ุฏูุฉ ุงููุตูู โ
- [ ] ุงุฎุชุจุงุฑ 2: ุงูุฅุดุนุงุฑุงุช ุงูููุฑูุฉ โ
- [ ] ุงุฎุชุจุงุฑ 3: ุชุญุฏูุซ ุงูุญุงูุฉ โ
- [ ] ุงุฎุชุจุงุฑ 4: ูุญุงุฏุซุฉ ุซูุงุฆูุฉ ุงูุงุชุฌุงู โ
- [ ] ุงุฎุชุจุงุฑ 5: ููุน ุงูุฃุฎุทุงุก โ
- [ ] ุงุฎุชุจุงุฑ 6: ุงูุฃูุงู โ
- [ ] ุงุฎุชุจุงุฑ 7: ุนุฑุถ ุงููุญุงุฏุซุงุช โ

### ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช โ

---

## ๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

### โ ูุธุงู ุงูุฏุฑุฏุดุฉ ูุนูู ุจุดูู ูุซุงูู:

1. **ุงูุฏูุฉ:** ุงูุฑุณุงุฆู ุชูุตู **ุจุงูุถุจุท** ูููุณุชูุจู ุงููุฑุงุฏ
2. **ุงูุฃูุงู:** ุญูุงูุฉ ูููุฉ ุถุฏ ุงูุฃุฎุทุงุก ูุงููุฌูุงุช
3. **ุงูุฃุฏุงุก:** ุงุณุชุฎุฏุงู ููุงุฑุณ ูุชุณุฑูุน ุงูุงุณุชุนูุงูุงุช
4. **ุงูููุซูููุฉ:** ุชุชุจุน ุฏููู ููุญุงูุงุช ูุงูุฃููุงุช
5. **ุงููุงูุนูุฉ:** ุจูุงูุงุช ุญููููุฉ ูููุซููุฉ

---

**A-TEAM @ F.G.M**  
**ยฉ 2024 Ibdaa Platform**
