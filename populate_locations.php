<?php
require_once __DIR__ . '/database/db.php';

$yemen_data = [
    "أمانة العاصمة" => ["الصافية","التحرير","الوحدة","السَّبعين","الثورة","شعوب","معين","بني الحارث"],
    "صنعاء" => ["بني مطر","سنحان وبني بهلول","بلاد الروس","الحيمة الداخلية","الحيمة الخارجية","خولان","بني حشيش","نهم","همدان","أرحب"],
    "تعز" => ["التعزية","صالة","المظفر","القاهرة","المواسط","الشمايتين","جبل حبشي","المعافر","المسراخ","صبر الموادم","ماوية","المخا","باب المندب","ذباب","المقبنة","حيفان","الصلو","شرعب الرونة","شرعب السلام","مشرعة وحدنان","سامع","الوازعية"],
    "عدن" => ["المنصورة","البريقة","الشيخ عثمان","خور مكسر","صيرة (كريتر)","دار سعد","التواهي","المعلا"],
    "إب" => ["الظهار","المشنة","ريف إب","بعدان","السياني","حزم العدين","العدين","النادرة","يريم","السدة","الشعر","المخادر","جبلة","فرع العدين","القفر"],
    "ذمار" => ["ذمار","عنس","الحداء","ميفعة عنس","جهران","وصاب العالي","وصاب السافل","الوده"],
    "الحديدة" => ["الحديدة","الحالي","الميناء","بيت الفقيه","المنصورية","باجل","زبيد","الضحي","اللحية","القناوص","الزهرة","المنيرة","السخنة","حيس","الجراحي","التحيتا","الدريهمي","بُرَع","الحُجَيلة"],
    "البيضاء" => ["البيضاء","السواديّة","الزاهر","الصومعة","الملاجم","ناطع","نعمان","رداع","القريشية","ولد ربيع","مسورة","الشرِيّة","ذي ناعم","الرياشية"],
    "ريمة" => ["الجبين","كسمة","السلفية","مزهر","بلاد الطعام","الجَعفرية"],
    "الضالع" => ["الضالع","قعطبة","جبن","دمت","الحشا","الأزارق","الحُصين","الشعيب","جُحاف"],
    "لحج" => ["تبن","الحوطة","المَسيمير","القبيطة","المَضاربة ورأس العارة","طور الباحة","يَافع","كرب"],
    "أبين" => ["زنجبار","خنفر","لودر","مَودية","المحفد","أحور","جيشان","سرار","رصد","سباح"],
    "شبوة" => ["عتق","بيحان","عسيلان","عين","نصاب","حَطيب","الصعيد","ميفعة","جردان","حَبّان","رَضوم","مرخة السفلى","مرخة العليا"],
    "حضرموت" => ["المكلا","الشحر","غيل باوزير","الديس الشرقية","بروم ميفع","حجر","سيئون","تريم","شبام","ساه","وادي العين وحورة","قطن","العبر","رخية"],
    "المهرة" => ["الغيضة","سيحوت","حوف","المسيلة","قشن","حصوين","حَساي","منعر","حَات"],
    "مأرب" => ["مدينة مأرب","الوادي","الجوبة","صرواح","مدغل","رغوان","رحبة","حريب","حريب القراميش"],
    "الجوف" => ["الغيل","الزاهر","الخلق","برط العنان","خب والشعف","الحزم","المتون","رجوزة","خَبّ"],
    "حجة" => ["حجة","المحابشة","أفلح الشام","أفلح اليمن","المغربة","الشاهل","الجميمة","كُشر","قارة","وشحة","بني قيس","بني العوام","ميدي","عبس","حرض","مستباء","كعيدنة","أسلم","القفل","بكيل المير","الشغادرة"],
    "صعدة" => ["صعدة","سحار","ساقين","رازح","غمر","شدا","منبه","كتاف والبقع","باقِم","الصفراء","الحشوة","مجز","حيدان"],
    "عمران" => ["عمران","ريدة","السودة","العشة","مديرية عيال سريح","مسور","خمر","قفلة عذر","حوث"],
    "سقطرى" => ["حديبو","قلنسية وعبدالكوري"]
];

echo "Starting population...\n";

// Create tables if not exist
$conn->query("CREATE TABLE IF NOT EXISTS regions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci");

$conn->query("CREATE TABLE IF NOT EXISTS districts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    region_id INT NOT NULL,
    name VARCHAR(100) NOT NULL,
    FOREIGN KEY (region_id) REFERENCES regions(id) ON DELETE CASCADE,
    UNIQUE KEY unique_district (region_id, name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci");

foreach ($yemen_data as $gov => $districts) {
    // Insert Region
    $stmt = $conn->prepare("INSERT IGNORE INTO regions (name) VALUES (?)");
    $stmt->bind_param("s", $gov);
    $stmt->execute();
    
    // Get Region ID
    $stmt = $conn->prepare("SELECT id FROM regions WHERE name = ?");
    $stmt->bind_param("s", $gov);
    $stmt->execute();
    $res = $stmt->get_result();
    $region = $res->fetch_assoc();
    $region_id = $region['id'];
    
    echo "Processing $gov (ID: $region_id)...\n";
    
    // Insert Districts
    $stmt_dist = $conn->prepare("INSERT IGNORE INTO districts (region_id, name) VALUES (?, ?)");
    foreach ($districts as $dist) {
        $stmt_dist->bind_param("is", $region_id, $dist);
        $stmt_dist->execute();
    }
}

echo "Done!\n";
